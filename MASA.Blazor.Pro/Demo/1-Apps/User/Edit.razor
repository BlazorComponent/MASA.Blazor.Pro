@page "/apps/user/edit"
@page "/apps/user/edit/{Id}"
@inherits DemoCompontentBase
@using MASA.Blazor.Pro.Data.User
@using System.Diagnostics.CodeAnalysis

<MCard>
    <MCardText Class="px-6 pb-6">
        <MTabs @bind-Value="tab" HideSlider Height=10 Color="sample-green">     
            <MTab Value="@("Account")">
                <MIcon Size=13 Color="@(tab=="Account"?"sample-green":"fill")">mdi-circle</MIcon>
                <span class="ml-2 text-btn @(tab=="Account"?"neutral--text":"")">Account</span>
            </MTab>
            <MTab Class="ml-2" Value="@("Information")">
                <MIcon Size=13 Color="@(tab=="Information"?"sample-green":"fill")">mdi-circle</MIcon>
                <span class="ml-2 text-btn @(tab=="Information"?"neutral--text":"")">Information</span>
            </MTab>
            <MTab Class="ml-2" Value="@("Social")">
                <MIcon Size=13 Color="@(tab=="Social"?"sample-green":"fill")">mdi-circle</MIcon>
                <span class="ml-2 text-btn @(tab=="Social"?"neutral--text":"")">Social</span>
            </MTab>
        </MTabs>
        <MTabsItems @bind-Value="tab" Class="mt-4">
            <MTabItem Value="@("Account")">
                <div class="d-flex block-center">
                    @if (string.IsNullOrEmpty(UserData.HeadImg))
                    {
                        string color = UserData.Color;
                        <MAvatar Size="120" Color="@($"{color} lighten-5")">
                            <span class="@($"{color}--text text-h3")">@UserData.SampleName</span>
                        </MAvatar>
                    }
                    else
                    {
                        <MAvatar Size="120">
                            <MImage Src="@UserData.HeadImg" />
                        </MAvatar>
                    }
                    <div Class="ml-6">
                        <h5 class="mb-6">@UserData.FullName</h5>
                        <MButton Color="primary" MinWidth=80 Height=30> Update </MButton>
                        <MButton Outlined MinWidth=80 Height=30 Class="ml-6 text-btn"> Remove </MButton>
                    </div>
                </div>
                <MRow Class="my-3">
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.UserName" Color="primary" Label="UserName" HideDetails="@("auto")" Outlined/>
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.FullName" Color="primary" Label="FullName" HideDetails="@("auto")" Outlined/>
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Email" Color="primary" Label="Email" HideDetails="@("auto")" Outlined/>
                    </MCol>
                </MRow>
                <MRow>
                    <MCol Md=4 Sm=12>
                        <MSelect @bind-Value="UserData.Status"
                                 Color="primary"
                                 HideDetails="@("auto")"
                                 Outlined                                
                                 Items="@UserService.Status"
                                 ItemText="u => u"
                                 ItemValue="u => u"
                                 Label="Status">
                        </MSelect>
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MSelect @bind-Value="UserData.Role"
                                 Color="primary"
                                 HideDetails="@("auto")"
                                 Outlined                                 
                                 Items="@UserService.Roles"
                                 ItemText="u => u"
                                 ItemValue="u => u"
                                 Label="Role">
                        </MSelect>
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Company" Color="primary" Label="Company" HideDetails="@("auto")" Outlined />
                    </MCol>
                </MRow>

                <div class="mt-12 mb-3">
                    <MIcon Size=20 Class="mt-n1">mdi-lock-open-outline</MIcon>
                    <span class="ml-1 text-h6">Permission</span>
                </div>
                <MDataTable Stripe HideDefaultFooter Headers="_headers" Items="UserData.Permissions" ItemKey="r=>r.Module" Class="border-solid elevation-1">
                    <ItemColContent>
                        @switch (context.Header.Value)
                        {
                            case nameof(Permission.Module):
                                @context.Value
                                break;
                            case nameof(Permission.Read):
                                <MCheckbox Color="primary" @bind-Value="context.Item.Read"></MCheckbox>
                                break;
                            case nameof(Permission.Write):
                                <MCheckbox Color="primary" @bind-Value="context.Item.Write"></MCheckbox>
                                break;
                            case nameof(Permission.Create):
                                <MCheckbox Color="primary" @bind-Value="context.Item.Create"></MCheckbox>
                                break;
                            case nameof(Permission.Delete):
                                <MCheckbox Color="primary" @bind-Value="context.Item.Delete"></MCheckbox>
                                break;
                            default:
                                @context.Value
                                break;
                        }
                    </ItemColContent>
                </MDataTable>
            </MTabItem>

            <MTabItem Value="@("Information")">
                <div>
                    <MIcon Small Class="mt-n1">far fa-user</MIcon>
                    <span class="ml-2 text-h6">Personal Information</span>
                </div>

                <MRow Class="mt-4">
                    <MCol Md=4 Sm=12>
                        <MMenu CloseOnContentClick="true" NudgeRight="40" Transition="scale-transition" OffsetY MinWidth="@("auto")">
                            <ActivatorContent Context="menuContext">
                                <MTextField @bind-Value=UserData.BirthDate Label="BirthDate" Color="primary" Dense Outlined @attributes="menuContext.Attrs"></MTextField>
                            </ActivatorContent>
                            <ChildContent>
                                <MDatePicker Color="primary" @bind-Value=UserData.BirthDate></MDatePicker>
                            </ChildContent>
                        </MMenu>
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Mobile" Label="Mobile" Color="primary" Dense Outlined TValue="string" Class="" />
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Website" Label="Website" Color="primary" Dense Outlined TValue="string" Class="" />
                    </MCol>
                </MRow>

                <MRow Class="mt-n6">
                    <MCol Md=4 Sm=12>
                        <MSelect @bind-Value="UserData.Language"
                                 Color="primary"
                                 Outlined
                                 Dense
                                 Items="@UserService.Languages"
                                 ItemText="u => u"
                                 ItemValue="u => u"
                                 Label="Language">
                        </MSelect>
                    </MCol>
                    <MCol Md=4 Sm=12 Class="mt-n4">
                        <span>Gender</span>
                        <MRadioGroup @bind-Value="UserData.Gender" Color="primary" Row Class="mt-1">
                            <MRadio Color="primary" Label="Male" Value="@("Male")"></MRadio>
                            <MRadio Color="primary" Label="Female" Value="@("Female")"></MRadio>
                        </MRadioGroup>
                    </MCol>
                    <MCol Md=4 Sm=12 Class="mt-n5">
                        <span class="mr-2">Contact Options</span>
                        <div class="d-flex mt-n2">
                            <MCheckbox Label="Email" HideDetails="true" Color="primary"></MCheckbox>
                            <MCheckbox Label="Message" HideDetails="true" Color="primary" Class="ml-2"></MCheckbox>
                            <MCheckbox Label="Phone" HideDetails="true" Color="primary" Class="ml-2"></MCheckbox>
                        </div>

                    </MCol>
                </MRow>

                <div>
                    <MIcon Small Class="mt-n1">fas fa-map-marker-alt</MIcon>
                    <span class="ml-2 text-h6">Address</span>
                    <MRow>
                        <MCol Md=4 Sm=12>
                            <MTextField @bind-Value="UserData.Address1" Label="Address Line 1" Color="primary" Dense Outlined TValue="string" Class="" />
                        </MCol>
                        <MCol Md=4 Sm=12>
                            <MTextField @bind-Value="UserData.Address2" Label="Address Line 2" Color="primary" Dense Outlined TValue="string" Class="" />
                        </MCol>
                        <MCol Md=4 Sm=12>
                            <MTextField @bind-Value="UserData.Address3" Label="Address Line 3" Color="primary" Dense Outlined TValue="string" Class="" />
                        </MCol>
                    </MRow>
                    <MRow Class="mt-n6">
                        <MCol Md=4 Sm=12>
                            <MTextField @bind-Value="UserData.City" Label="City" Color="primary" Dense Outlined TValue="string" Class="" />
                        </MCol>
                        <MCol Md=4 Sm=12>
                            <MTextField @bind-Value="UserData.State" Label="State" Color="primary" Dense Outlined TValue="string" Class="" />
                        </MCol>
                        <MCol Md=4 Sm=12>
                            <MTextField @bind-Value="UserData.Country" Label="Country" Color="primary" Dense Outlined TValue="string" Class="" />
                        </MCol>
                    </MRow>
                </div>
            </MTabItem>

            <MTabItem Value="@("Social")">
                <MRow>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Twitter" Label="Twitter" Color="primary" Dense Outlined TValue="string" PrependInnerIcon="fab fa-twitter" />
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Facebook" Label="Facebook" Color="primary" Dense Outlined TValue="string" PrependInnerIcon="fab fa-facebook-f" />
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Instagram" Label="Instagram" Color="primary" Dense Outlined TValue="string" PrependInnerIcon="fab fa-instagram" />
                    </MCol>
                </MRow>
                <MRow Class="mt-n6">
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Github" Label="Github" Color="primary" Dense Outlined TValue="string" PrependInnerIcon="fab fa-github" />
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Codepen" Label="Codepen" Color="primary" Dense Outlined TValue="string" PrependInnerIcon="fab fa-codepen" />
                    </MCol>
                    <MCol Md=4 Sm=12>
                        <MTextField @bind-Value="UserData.Slack" Label="Slack" Color="primary" Dense Outlined TValue="string" PrependInnerIcon="fab fa-slack" />
                    </MCol>
                </MRow>
            </MTabItem>
        </MTabsItems>

        <div class="mt-10 d-flex">
            <MSpacer></MSpacer>
            <MButton MinWidth=80 Height=40 Color="primary"> Save Changes </MButton>
            <MButton MinWidth=80 Height=40 Outlined Class="ml-6 text-btn"> Reset </MButton>
        </div>
    </MCardText>
</MCard>

@code {
    public override string Name { get; } = "User-Edit";

    [Parameter]
    public string? Id { get; set; }

    UserData? _userData;

    [AllowNull]
    public UserData UserData
    {
        get
        {
            return _userData ?? UserService.UserDatas.First();
        }
        set
        {
            _userData = value;
        }
    }

    protected override void OnParametersSet()
    {
        UserData = UserService.UserDatas.FirstOrDefault(u => u.Id == Id);
    }

    private List<DataTableHeader<Permission>> _headers = new List<DataTableHeader<Permission>>
    {
        new (){ Text= "MODULE", Sortable= false, Value= nameof(Permission.Module)},
        new (){ Text= "READ", Sortable= false, Value= nameof(Permission.Read)},
        new (){ Text= "WRITE", Sortable= false, Value= nameof(Permission.Write)},
        new (){ Text= "CREATE", Sortable= false, Value= nameof(Permission.Create)},
        new (){ Text= "DELETE", Sortable= false, Value= nameof(Permission.Delete)}
    };

    StringNumber? tab;
}
